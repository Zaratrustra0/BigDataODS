# é¢å¯¹æŒç»­ä¸æ–­ç”Ÿæˆçš„æµæ•°æ®â€”â€” Amazon Kinesis Data Analytics å®ç°åŠæ—¶åˆ†æä¸å¤„ç†
![](https://mmbiz.qpic.cn/mmbiz_gif/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLwC2aT3PiakSv6zyT1sicG0wEEEyuad3ByUxOyeyQhywwIBH52icwGvbtg/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLiacAL3N6F77xESgBhcg4C3Aicn2Ylvn6yyteY0WjT3NfQCY96gFcMZbQ/640?wx_fmt=png)

**Amazon Kinesis Data Analytics ä»‹ç»**

å¦‚ä»Šå„ç§ä¼ä¸šæ¯å¤©éƒ½åœ¨é¢å¯¹æŒç»­ä¸æ–­ç”Ÿæˆçš„æ•°æ®éœ€è¦å¤„ç†ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªç§»åŠ¨æˆ– Web åº”ç”¨ç¨‹åºç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ã€ç½‘ä¸Šè´­ç‰©æ•°æ®ã€æ¸¸æˆç©å®¶æ´»åŠ¨ã€ç¤¾äº¤ç½‘ç«™ä¿¡æ¯æˆ–è€…æ˜¯é‡‘èäº¤æ˜“ç­‰ã€‚**èƒ½å¤ŸåŠæ—¶åœ°å¤„ç†å¹¶åˆ†æè¿™äº›æµæ•°æ®å¯¹ä¼ä¸šæ¥è¯´è‡³å…³é‡è¦**ï¼Œé€šè¿‡è‰¯å¥½çš„æµæ•°æ®å¤„ç†å’Œåº”ç”¨ï¼Œä¼ä¸šå¯ä»¥å¿«é€Ÿåšå‡ºä¸šåŠ¡å†³ç­–ï¼Œæ”¹è¿›äº§å“æˆ–æœåŠ¡çš„è´¨é‡ï¼Œæå‡ç”¨æˆ·çš„æ»¡æ„åº¦ã€‚

ç›®å‰ï¼Œå¸‚é¢ä¸Šå·²ç»æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥å¸®åŠ©ä¼ä¸šå®ç°æµæ•°æ®çš„å¤„ç†å’Œåˆ†æã€‚å…¶ä¸­ï¼Œ**Apache Flink**æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æ•°æ®æµçš„æµè¡Œæ¡†æ¶å’Œå¼•æ“ï¼Œç”¨äºåœ¨æ— è¾¹ç•Œå’Œæœ‰è¾¹ç•Œæ•°æ®æµä¸Šè¿›è¡Œæœ‰çŠ¶æ€çš„è®¡ç®—ã€‚Flink èƒ½åœ¨æ‰€æœ‰å¸¸è§é›†ç¾¤ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶èƒ½ä»¥å†…å­˜é€Ÿåº¦å’Œä»»æ„è§„æ¨¡è¿›è¡Œè®¡ç®—ã€‚

-   Apache Flink

    [https://flink.apache.org](https://flink.apache.org)

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLk7aCKY0TUPDZEEiblQEiaPCK7Iolt8zoLr4c4yR9BxYfgl1DteVOkNhg/640?wx_fmt=png)

å›¾ç‰‡æ¥è‡ª Apache Flink å®˜ç½‘

Amazon Kinesis Data Analytics æ˜¯å¿«é€Ÿä½¿ç”¨ Apache Flink å®æ—¶è½¬æ¢å’Œåˆ†ææµæ•°æ®çš„ç®€å•æ–¹æ³•ï¼Œé€šè¿‡æ— æœåŠ¡å™¨æ¶æ„å®ç°æµæ•°æ®çš„å¤„ç†å’Œåˆ†æã€‚å€ŸåŠ© Amazon Kinesis Data Analyticsï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åŸºäº Apache Flink çš„å¼€æºåº“æ„å»º Javaã€Scala ä»¥åŠ Python åº”ç”¨ç¨‹åºã€‚

**Amazon** \***\*Kinesis\*\*\*\***Data Analytics ä¸ºæ‚¨çš„ Apache Flink åº”ç”¨ç¨‹åºæä¾›åº•å±‚åŸºç¡€è®¾æ–½ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬æä¾›è®¡ç®—èµ„æºã€å¹¶è¡Œè®¡ç®—ã€è‡ªåŠ¨ä¼¸ç¼©å’Œåº”ç”¨ç¨‹åºå¤‡ä»½ \*\*ï¼ˆä»¥æ£€æŸ¥ç‚¹å’Œå¿«ç…§çš„å½¢å¼å®ç°ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é«˜çº§ Flink ç¼–ç¨‹ç‰¹æ€§ï¼ˆå¦‚æ“ä½œç¬¦ã€å‡½æ•°ã€æºå’Œæ¥æ”¶å™¨ç­‰ï¼‰ï¼Œå°±åƒæ‚¨è‡ªå·±åœ¨æ‰˜ç®¡ Flink åŸºç¡€è®¾æ–½æ—¶ä½¿ç”¨å®ƒä»¬ä¸€æ ·ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLiacAL3N6F77xESgBhcg4C3Aicn2Ylvn6yyteY0WjT3NfQCY96gFcMZbQ/640?wx_fmt=png)

ğŸ“¢Â Â æƒ³è¦äº†è§£æ›´å¤šäºšé©¬é€Šäº‘ç§‘æŠ€æœ€æ–°æŠ€æœ¯å‘å¸ƒå’Œå®è·µåˆ›æ–°ï¼Œæ•¬è¯·å…³æ³¨ 2021 äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½å³°ä¼šï¼ç‚¹å‡»å›¾ç‰‡æŠ¥åå§ï½

**åœ¨ Amazon Kinesis Data Analytics**

**ä½¿ç”¨ Python**

Amazon Kinesis Data Analytics for Apache Flink ç°åœ¨æ”¯æŒä½¿ç”¨ Python 3.7 æ„å»ºæµæ•°æ®åˆ†æåº”ç”¨ç¨‹åºã€‚**è¿™ä½¿æ‚¨èƒ½å¤Ÿä»¥ Python è¯­è¨€åœ¨ Amazon Kinesis Data Analytics ä¸Šé€šè¿‡ Apache Flink v1.11 è¿è¡Œå¤§æ•°æ®åˆ†æ**ï¼Œå¯¹ Python è¯­è¨€å¼€å‘è€…æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚Apache Flink v1.11 é€šè¿‡ PyFlink Table API æä¾›å¯¹ Python çš„æ”¯æŒï¼Œè¿™æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å…³ç³»å‹ APIã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLsSWEGZl3P99Uk2KFpMY7YBehARMfR1Cu8q7CricbibNkNLgr27ez6UHg/640?wx_fmt=png)

å›¾ç‰‡æ¥è‡ª Apache Flink å®˜ç½‘  

æ­¤å¤–ï¼ŒApache Flink è¿˜æä¾›äº†ä¸€ä¸ªç”¨äºç»†ç²’åº¦æ§åˆ¶çŠ¶æ€å’Œæ—¶é—´çš„ DataStream APIï¼Œå¹¶ä¸”ä» Apache Flink 1.12 ç‰ˆæœ¬å¼€å§‹å°±æ”¯æŒ Python DataStream APIã€‚æœ‰å…³ Apache Flink ä¸­ API çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…**Flink å®˜ç½‘ä»‹ç»**ã€‚

-   Flink å®˜ç½‘ä»‹ç»

    [https://ci.apache.org/projects/flink/flink-docs-release-1.11/concepts/index.html](https://ci.apache.org/projects/flink/flink-docs-release-1.11/concepts/index.html)

**Amazon Kinesis Data AnalyticsÂ Python**

**åº”ç”¨ç¨‹åºç¤ºä¾‹**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•å¿«é€Ÿä¸Šæ‰‹æ„å»º Python ç‰ˆçš„ Amazon Kinesis Data Analytics for Flink åº”ç”¨ç¨‹åºã€‚ç¤ºä¾‹çš„å‚è€ƒæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†å‘é€ä¸€äº›æµ‹è¯•æ•°æ®åˆ° Amazon Kinesis Data Streamï¼Œç„¶åé€šè¿‡ Amazon Kinesis Data Analytics Python åº”ç”¨ç¨‹åºçš„ Tumbling Window çª—å£å‡½æ•°åšåŸºæœ¬çš„èšåˆæ“ä½œï¼Œå†å°†è¿™äº›æ•°æ®æŒä¹…åŒ–åˆ° Amazon S3 ä¸­ï¼›ä¹‹åå¯ä»¥ä½¿ç”¨ Amazon Glue å’Œ Amazon Athena å¯¹è¿™äº›æ•°æ®è¿›è¡Œå¿«é€Ÿçš„æŸ¥è¯¢ã€‚æ•´ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºéƒ½é‡‡ç”¨äº†æ— æœåŠ¡å™¨çš„æ¶æ„ï¼Œåœ¨å¯ä»¥å®ç°å¿«é€Ÿéƒ¨ç½²å’Œè‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©å¤–ï¼Œè¿˜æå¤§åœ°å‡è½»äº†è¿ç»´å’Œç®¡ç†è´Ÿæ‹…ã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLt1O66rz3mB59joq3IvDUoGA6icQ9tkLSt6f0WCnE3ZvIHULRypLrg6A/640?wx_fmt=jpeg)

ä»¥ä¸‹ç¤ºä¾‹æ˜¯åœ¨ç”±å…‰ç¯æ–°ç½‘è¿è¥çš„äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½ï¼ˆåŒ—äº¬ï¼‰åŒºåŸŸä¸Šè¿›è¡Œã€‚  

**åˆ›å»º Amazon Kinesis Data Stream**

ç¤ºä¾‹å°†åœ¨æ§åˆ¶å°ä¸Šåˆ›å»º Amazon Kinesis Data Streamï¼Œé¦–å…ˆé€‰æ‹©åˆ° Amazon Kinesis æœåŠ¡ - æ•°æ®æµï¼Œç„¶åç‚¹å‡» â€œåˆ›å»ºæ•°æ®æµâ€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcL5WBibzWab63Ots7oZ7795AYRiamGAn4xuZBQBnI7p1zEZrwqmPh6SR0A/640?wx_fmt=jpeg)

è¾“å…¥æ•°æ®æµåç§°ï¼Œå¦‚ â€œkda-input-streamâ€œï¼›æ•°æ®æµå®¹é‡ä¸­çš„åˆ†åŒºæ•°è®¾ç½®ä¸º 1ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µé…ç½®åˆé€‚çš„å®¹é‡ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLu8nqtkyvDIgEF70C42C6fcva5t2m604VafL4H8LjOSsRJ40IGVFwWg/640?wx_fmt=png)

ç‚¹å‡»åˆ›å»ºæ•°æ®æµï¼Œç­‰å¾…ç‰‡åˆ»ï¼Œæ•°æ®æµåˆ›å»ºå®Œæˆã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLvLI8JZ5WJsicS73GmbpYyQblWTQvia6FwMaK6Ay7JOGiafR4vlxJgRV3Q/640?wx_fmt=png)

ç¨åï¼Œæˆ‘ä»¬å°†åƒè¿™ä¸ª Amazon Kinesis æ•°æ®æµå‘é€ç¤ºä¾‹æ•°æ®ã€‚

**åˆ›å»º Amazon S3 å­˜å‚¨æ¡¶**

ç¤ºä¾‹å°†åœ¨æ§åˆ¶å°ä¸Šåˆ›å»º Amazon S3 å­˜å‚¨æ¡¶ï¼Œé¦–å…ˆé€‰æ‹©åˆ° Amazon Kinesis æœåŠ¡ï¼Œç„¶åç‚¹å‡» â€œåˆ›å»ºå­˜å‚¨æ¡¶â€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLuDnVrhobSfeLOGn2luZroe3P5EWKeNnvLHXBNIl0AldDXWReibaqS8Q/640?wx_fmt=png)

è¾“å…¥å­˜å‚¨æ¡¶åç§°ï¼Œå¦‚ â€œkda-pyflink-\*\*\*â€ï¼Œè¿™ä¸ªåç§°ç¨åæˆ‘ä»¬åœ¨ Amazon Kinesis åº”ç”¨ç¨‹åºä¸­ç”¨åˆ°ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLloGtVzuyUtNShWp83AW8FjNX9uM3PgTfCRFc2Z0VhWVQeq7h8IcOcA/640?wx_fmt=png)

ä¿æŒå…¶å®ƒé…ç½®ä¸å˜ï¼Œç‚¹å‡» â€œåˆ›å»ºå­˜å‚¨æ¡¶â€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLib6k9fiahHKtpgQqDFnSFIGhic5qGziaqQxGDvrUzCz4QX5QyDyspCziblg/640?wx_fmt=png)

ç¨ç­‰ç‰‡åˆ»ï¼Œå¯ä»¥çœ‹åˆ°å·²æˆåŠŸåˆ›å»ºå­˜å‚¨æ¡¶ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLKRDKtZaTGkQm5qg0JHASKg4RxWG60f60xFvGU3jaI3xMP3N1xML9ng/640?wx_fmt=png)

**å‘é€ç¤ºä¾‹æ•°æ®åˆ°**

**Amazon Kinesis Data Stream**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€æ®µ Python ç¨‹åºå‘ Amazon Kinesis æ•°æ®æµå‘é€æ•°æ®ã€‚åˆ›å»º kda-input-stream.py æ–‡ä»¶ï¼Œå¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ STREAM_NAME ä¸ºæ‚¨åˆšåˆšåˆ›å»ºçš„ Amazon Kinesis æ•°æ®æµåç§°ï¼Œprofile_name é…ç½®ä¸ºå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ã€‚

    importÂ datetimeimportÂ jsonimportÂ randomimportÂ boto3STREAM_NAMEÂ =Â "kda-input-stream"defÂ get_data():Â Â Â Â returnÂ {Â Â Â Â Â Â Â Â 'event_time':Â datetime.datetime.now().isoformat(),Â Â Â Â Â Â Â Â 'ticker':Â random.choice(['AAPL',Â 'AMZN',Â 'MSFT',Â 'INTC',Â 'TBV']),Â Â Â Â Â Â Â Â 'price':Â round(random.random()Â *Â 100,Â 2)}defÂ generate(stream_name,Â kinesis_client):Â Â Â Â whileÂ True:Â Â Â Â Â Â Â Â dataÂ =Â get_data()Â Â Â Â Â Â Â Â print(data)Â Â Â Â Â Â Â Â kinesis_client.put_record(Â Â Â Â Â Â Â Â Â Â Â Â StreamName=stream_name,Â Â Â Â Â Â Â Â Â Â Â Â Data=json.dumps(data),Â Â Â Â Â Â Â Â Â Â Â Â PartitionKey="partitionkey")ifÂ __name__Â ==Â '__main__':Â Â Â Â sessionÂ =Â boto3.Session(profile_name='<yourÂ profile>')Â Â Â Â generate(STREAM_NAME,Â session.client('kinesis',Â region_name='cn-n

æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œå¼€å§‹å‘ Amazon Kinesis æ•°æ®æµå‘é€æ•°æ®ã€‚

    $Â pythonÂ kda-input-stream.py

**ç¼–å†™ Pyflink ä»£ç **

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç¼–å†™ PyFlink ä»£ç ã€‚åˆ›å»º kda-pyflink-demo.py æ–‡ä»¶ï¼Œå¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚

    #Â -*-Â coding:Â utf-8Â -*-"""kda-pyflink-demo.py~~~~~~~~~~~~~~~~~~~1.Â åˆ›å»ºÂ TableÂ Environment2.Â åˆ›å»ºæºÂ KinesisÂ DataÂ Stream3.Â åˆ›å»ºç›®æ ‡Â S3Â Bucket4.Â æ‰§è¡Œçª—å£å‡½æ•°æŸ¥è¯¢5.Â å°†ç»“æœå†™å…¥ç›®æ ‡"""fromÂ pyflink.tableÂ importÂ EnvironmentSettings,Â StreamTableEnvironmentfromÂ pyflink.table.windowÂ importÂ TumbleimportÂ osimportÂ json#Â 1.Â åˆ›å»ºÂ TableÂ Environmentenv_settingsÂ =Â (Â Â Â Â EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build())table_envÂ =Â StreamTableEnvironment.create(environment_settings=env_settings)statement_setÂ =Â table_env.create_statement_set()APPLICATION_PROPERTIES_FILE_PATHÂ =Â "/etc/flink/application_properties.json"defÂ get_application_properties():Â Â Â Â ifÂ os.path.isfile(APPLICATION_PROPERTIES_FILE_PATH):Â Â Â Â Â Â Â Â withÂ open(APPLICATION_PROPERTIES_FILE_PATH,Â "r")Â asÂ file:Â Â Â Â Â Â Â Â Â Â Â Â contentsÂ =Â file.read()Â Â Â Â Â Â Â Â Â Â Â Â propertiesÂ =Â json.loads(contents)Â Â Â Â Â Â Â Â Â Â Â Â returnÂ propertiesÂ Â Â Â else:Â Â Â Â Â Â Â Â print('AÂ fileÂ atÂ "{}"Â wasÂ notÂ found'.format(APPLICATION_PROPERTIES_FILE_PATH))defÂ property_map(props,Â property_group_id):Â Â Â Â forÂ propÂ inÂ props:Â Â Â Â Â Â Â Â ifÂ prop["PropertyGroupId"]Â ==Â property_group_id:Â Â Â Â Â Â Â Â Â Â Â Â returnÂ prop["PropertyMap"]defÂ create_source_table(table_name,Â stream_name,Â region,Â stream_initpos):Â Â Â Â returnÂ """Â CREATEÂ TABLEÂ {0}Â (Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tickerÂ VARCHAR(6),Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â priceÂ DOUBLE,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â event_timeÂ TIMESTAMP(3),Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â WATERMARKÂ FORÂ event_timeÂ ASÂ event_timeÂ -Â INTERVALÂ '5'Â SECONDÂ Â Â Â Â Â Â Â Â Â Â Â Â Â )Â Â Â Â Â Â Â Â Â Â Â Â Â Â PARTITIONEDÂ BYÂ (ticker)Â Â Â Â Â Â Â Â Â Â Â Â Â Â WITHÂ (Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'connector'Â =Â 'kinesis',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'stream'Â =Â '{1}',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'aws.region'Â =Â '{2}',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'scan.stream.initpos'Â =Â '{3}',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'format'Â =Â 'json',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'json.timestamp-format.standard'Â =Â 'ISO-8601'Â Â Â Â Â Â Â Â Â Â Â Â Â Â )Â """.format(Â Â Â Â Â Â Â Â table_name,Â stream_name,Â region,Â stream_initposÂ Â Â Â )defÂ create_sink_table(table_name,Â bucket_name):Â Â Â Â returnÂ """Â CREATEÂ TABLEÂ {0}Â (Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tickerÂ VARCHAR(6),Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â priceÂ DOUBLE,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â event_timeÂ TIMESTAMP(3),Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â WATERMARKÂ FORÂ event_timeÂ ASÂ event_timeÂ -Â INTERVALÂ '5'Â SECONDÂ Â Â Â Â Â Â Â Â Â Â Â Â Â )Â Â Â Â Â Â Â Â Â Â Â Â Â Â PARTITIONEDÂ BYÂ (ticker)Â Â Â Â Â Â Â Â Â Â Â Â Â Â WITHÂ (Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'connector'='filesystem',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'path'='s3a://{1}/',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'format'='csv',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'sink.partition-commit.policy.kind'='success-file',Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'sink.partition-commit.delay'Â =Â '1Â min'Â Â Â Â Â Â Â Â Â Â Â Â Â Â )Â """.format(Â Â Â Â Â Â Â Â table_name,Â bucket_name)defÂ count_by_word(input_table_name):Â Â Â Â #Â ä½¿ç”¨Â TableÂ APIÂ Â Â Â input_tableÂ =Â table_env.from_path(input_table_name)Â Â Â Â tumbling_window_tableÂ =Â (Â Â Â Â Â Â Â Â input_table.window(Â Â Â Â Â Â Â Â Â Â Â Â Tumble.over("1.minute").on("event_time").alias("one_minute_window")Â Â Â Â Â Â Â Â )Â Â Â Â Â Â Â Â .group_by("ticker,Â one_minute_window")Â Â Â Â Â Â Â Â .select("ticker,Â price.avgÂ asÂ price,Â one_minute_window.endÂ asÂ event_time")Â Â Â Â )Â Â Â Â returnÂ tumbling_window_tabledefÂ main():Â Â Â Â #Â KDAÂ åº”ç”¨ç¨‹åºå±æ€§é”®Â Â Â Â input_property_group_keyÂ =Â "consumer.config.0"Â Â Â Â sink_property_group_keyÂ =Â "sink.config.0"Â Â Â Â input_stream_keyÂ =Â "input.stream.name"Â Â Â Â input_region_keyÂ =Â "aws.region"Â Â Â Â input_starting_position_keyÂ =Â "flink.stream.initpos"Â Â Â Â output_sink_keyÂ =Â "output.bucket.name"Â Â Â Â #Â è¾“å…¥è¾“å‡ºæ•°æ®è¡¨Â Â Â Â input_table_nameÂ =Â "input_table"Â Â Â Â output_table_nameÂ =Â "output_table"Â Â Â Â #Â è·å–Â KDAÂ åº”ç”¨ç¨‹åºå±æ€§Â Â Â Â propsÂ =Â get_application_properties()Â Â Â Â input_property_mapÂ =Â property_map(props,Â input_property_group_key)Â Â Â Â output_property_mapÂ =Â property_map(props,Â sink_property_group_key)Â Â Â Â input_streamÂ =Â input_property_map[input_stream_key]Â Â Â Â input_regionÂ =Â input_property_map[input_region_key]Â Â Â Â stream_initposÂ =Â input_property_map[input_starting_position_key]Â Â Â Â output_bucket_nameÂ =Â output_property_map[output_sink_key]Â Â Â Â #Â 2.Â åˆ›å»ºæºÂ KinesisÂ DataÂ StreamÂ Â Â Â table_env.execute_sql(Â Â Â Â Â Â Â Â create_source_table(Â Â Â Â Â Â Â Â Â Â Â Â input_table_name,Â input_stream,Â input_region,Â stream_initposÂ Â Â Â Â Â Â Â )Â Â Â Â )Â Â Â Â #Â 3.Â åˆ›å»ºç›®æ ‡Â S3Â BucketÂ Â Â Â create_sinkÂ =Â create_sink_table(Â Â Â Â Â Â Â Â output_table_name,Â output_bucket_nameÂ Â Â Â )Â Â Â Â table_env.execute_sql(create_sink)Â Â Â Â #Â 4.Â æ‰§è¡Œçª—å£å‡½æ•°æŸ¥è¯¢Â Â Â Â tumbling_window_tableÂ =Â count_by_word(input_table_name)Â Â Â Â #Â 5.Â å°†ç»“æœå†™å…¥ç›®æ ‡Â Â Â Â tumbling_window_table.execute_insert(output_table_name).wait()Â Â Â Â statement_set.execute()ifÂ __name__Â ==Â "__main__":Â Â Â Â main()

å› ä¸ºåº”ç”¨ç¨‹åºè¦ä½¿ç”¨åˆ° Amazon Kinesis Flink SQL Connectorï¼Œè¿™é‡Œéœ€è¦å°†å¯¹åº”çš„**amazon-kinesis-sql-connector-flink-2.0.3.jar**ä¸‹è½½ä¸‹æ¥ã€‚

-   amazon-kinesis-sql-connector-flink-2.0.3.jar

    [https://repo1.maven.org/maven2/software/amazon/kinesis/amazon-kinesis-sql-connector-flink/2.0.3/amazon-kinesis-sql-connector-flink-2.0.3.jar](https://repo1.maven.org/maven2/software/amazon/kinesis/amazon-kinesis-sql-connector-flink/2.0.3/amazon-kinesis-sql-connector-flink-2.0.3.jar)

å°† kda-pyflink-demo.py å’Œ amazon-kinesis-sql-connector-flink-2.0.3.jar æ‰“åŒ…æˆ zip æ–‡ä»¶ï¼Œä¾‹å¦‚ kda-pyflink-demo.zip/ï¼›ç„¶åï¼Œå°†è¿™ä¸ª zip åŒ…ä¸Šä¼ åˆ°åˆšåˆšåˆ›å»ºçš„ Amazon S3 å­˜å‚¨æ¡¶ä¸­ã€‚è¿›å…¥åˆšåˆšåˆ›å»ºçš„ Amazon S3 å­˜å‚¨æ¡¶ï¼Œç‚¹å‡» â€œä¸Šä¼ â€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLIruwdoklvmL8XXEjSwZSsicEmLOB9qDNI4wMdcXD6eVDfh2OIhncn4Q/640?wx_fmt=jpeg)

é€‰æ‹©åˆšåˆšæ‰“åŒ…å¥½çš„ zip æ–‡ä»¶ï¼Œç„¶åç‚¹å‡» â€œä¸Šä¼ â€ã€‚  

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLWytbbWHg6CLofQeQ1GlvrAYGShn2jWcicpvA4pCmuicE08canm1kKf7w/640?wx_fmt=png)

**åˆ›å»º Python Amazon Kinesis Data Analytics**

**åº”ç”¨ç¨‹åº**

é¦–å…ˆé€‰æ‹©åˆ° Amazon Kinesis æœåŠ¡ - Data Analyticsï¼Œç„¶åç‚¹å‡» â€œåˆ›å»ºåº”ç”¨ç¨‹åºâ€

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLkUKoUTFLJUR4BxOiavkvibPrEn3FDUv5YY6T8iaicvz4dgJg8e3NalvnPQ/640?wx_fmt=png)

è¾“å…¥åº”ç”¨ç¨‹åºåç§°ï¼Œä¾‹å¦‚ â€œkda-pyflink-demoâ€ï¼›è¿è¡Œæ—¶é€‰æ‹© Apache Flinkï¼Œä¿æŒé»˜è®¤ 1.11 ç‰ˆæœ¬ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLTFNUY34uK8wxtWrB5IoLz8iblCukn4IdRTGdibuVxEwVKIJhhGzfGGyQ/640?wx_fmt=png)

è®¿é—®æƒé™ä¿æŒé»˜è®¤ï¼Œä¾‹å¦‚ â€œåˆ›å»º / æ›´æ–° Amazon IAM è§’è‰² kinesis-analytics-kda-pyflink-demo-cn-north-1â€ï¼›åº”ç”¨ç¨‹åºè®¾ç½®çš„æ¨¡æ¿é€‰æ‹© â€œå¼€å‘â€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹© â€œç”Ÿäº§â€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLpsZvz2fFUI7SibSfQrSdEbyOJNUO37iaaTGX5jbwDf799ZAsl8MdLicXw/640?wx_fmt=png)

ç‚¹å‡» â€œåˆ›å»ºåº”ç”¨ç¨‹åºâ€ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œåº”ç”¨ç¨‹åºåˆ›å»ºå®Œæˆã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLnwFKYuJ9ia0yGFjDd0xRzicMuBKcNJwzVMPQwZeaGIrJchgDuoK8JLTg/640?wx_fmt=png)

æ ¹æ®æç¤ºï¼Œæˆ‘ä»¬ç»§ç»­é…ç½®åº”ç”¨ç¨‹åºï¼Œç‚¹å‡» â€œé…ç½®â€ï¼›ä»£ç ä½ç½®é…ç½®ä¸ºåˆšåˆšåˆ›å»ºçš„ Amazon S3 ä¸­çš„ zip åŒ…ä½ç½®ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLGa8WnYg9YAtv8vf5hYoLJYsibLzwXTFn6j1riaaWZYtz7xnCDAXRMJ0Q/640?wx_fmt=png)

ç„¶åå±•å¼€å±æ€§é…ç½®ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLJKgHxx4MlkyYYFhemsSaqTpIpLbJwqCGz1L2L42fBK0icRnTMGfeGjQ/640?wx_fmt=png)

åˆ›å»ºå±æ€§ç»„ï¼Œè®¾ç½®ç»„åä¸º â€œconsumer.config.0â€ï¼Œå¹¶é…ç½®ä»¥ä¸‹é”®å€¼å¯¹ï¼š

input.stream.name ä¸ºåˆšåˆšåˆ›å»ºçš„ Amazon Kinesis æ•°æ®æµï¼Œä¾‹å¦‚ kda-input-stream

aws.region ä¸ºå½“å‰åŒºåŸŸï¼Œè¿™é‡Œæ˜¯ cn-north-1

flink.stream.initpos è®¾ç½®è¯»å–æµçš„ä½ç½®ï¼Œé…ç½®ä¸º LATEST

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLzmxxH4x3gpsUrIeicCQT9tQibLhdATSb6MmcDPEMyiaQaWibSKN36Uznjw/640?wx_fmt=png)

åˆ›å»ºå±æ€§ç»„ï¼Œè®¾ç½®ç»„åä¸º â€œsink.config.0â€ï¼Œå¹¶é…ç½®ä»¥ä¸‹é”®å€¼å¯¹ï¼š

output.bucket.name ä¸ºåˆšåˆšåˆ›å»ºçš„ Amazon S3 å­˜å‚¨æ¡¶ï¼Œä¾‹å¦‚ kda-pyflink-shtian

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLSOeO9OPCbsZ8icy725tXehxCjibNe7eScZlUQnNaibwHByGJBaKmWUpuw/640?wx_fmt=png)

åˆ›å»ºå±æ€§ç»„ï¼Œè®¾ç½®ç»„åä¸º â€œkinesis.analytics.flink.run.optionsâ€ï¼Œå¹¶é…ç½®ä»¥ä¸‹é”®å€¼å¯¹ï¼š

python ä¸ºåˆšåˆšåˆ›å»ºçš„ PyFlink ç¨‹åºï¼Œkda-pyflink-demo.py

jarfile ä¸º Amazon Kinesis Connector çš„åç§°ï¼Œè¿™é‡Œæ˜¯ amazon-kinesis-sql-connector-flink-2.0.3.jar

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLVuuB6GxWGuqibsV2icf1VvTh3TPXcpiaib3AbJcRzoGZzQUQ4icUM5gtt7Q/640?wx_fmt=png)

ç„¶åç‚¹å‡» â€œæ›´æ–°â€ï¼Œåˆ·æ–°åº”ç”¨ç¨‹åºé…ç½®

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLyYKIEWvhndftDLshD2LeibbqSeJD7StibSMCMdw3u5ibsvoZRoKicAa0hw/640?wx_fmt=png)

æ¥ä¸‹æ¥ï¼Œé…ç½®åº”ç”¨ç¨‹åºä½¿ç”¨çš„ Amazon IAM è§’è‰²çš„æƒé™ã€‚è¿›å…¥åˆ° Amazon IAM ç•Œé¢ï¼Œé€‰æ‹©è§’è‰²ï¼Œç„¶åæ‰¾åˆ°åˆšåˆšæ–°åˆ›å»ºçš„è§’è‰²ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLP7uDN9onBZ0KbCqaTrl5cfB9H4MKXwPQVHUibF1FEicXYzfySumBpLow/640?wx_fmt=png)

ç„¶åï¼Œå±•å¼€é™„åŠ ç­–ç•¥ï¼Œå¹¶ç‚¹å‡» â€œç¼–è¾‘ç­–ç•¥â€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcL1GmngVtMmEK3J37RUwbIeLSxP8xb6gYzMkKZ2KeLIliaZ8EMicjtBpHg/640?wx_fmt=png)

è¡¥å……æœ€åä¸¤æ®µ Amazon IAM ç­–ç•¥ï¼Œå…è®¸è¯¥è§’è‰²å¯ä»¥è®¿é—® Amazon Kinesis æ•°æ®æµå’Œ Amazon S3 å­˜å‚¨æ¡¶ï¼Œæ³¨æ„éœ€è¦æ›¿æ¢ä¸ºæ‚¨çš„äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½åŒºè´¦å·ã€‚

    {Â Â Â Â "Version":Â "2012-10-17",Â Â Â Â "Statement":Â [Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â "Sid":Â "ReadCode",Â Â Â Â Â Â Â Â Â Â Â Â "Effect":Â "Allow",Â Â Â Â Â Â Â Â Â Â Â Â "Action":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:GetObject",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:GetObjectVersion"Â Â Â Â Â Â Â Â Â Â Â Â ],Â Â Â Â Â Â Â Â Â Â Â Â "Resource":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "arn:aws-cn:s3:::kda-pyflink-shtian/kda-pyflink-demo.zip"Â Â Â Â Â Â Â Â Â Â Â Â ]Â Â Â Â Â Â Â Â },Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â "Sid":Â "ListCloudwatchLogGroups",Â Â Â Â Â Â Â Â Â Â Â Â "Effect":Â "Allow",Â Â Â Â Â Â Â Â Â Â Â Â "Action":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "logs:DescribeLogGroups"Â Â Â Â Â Â Â Â Â Â Â Â ],Â Â Â Â Â Â Â Â Â Â Â Â "Resource":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "arn:aws-cn:logs:cn-north-1:012345678901:log-group:*"Â Â Â Â Â Â Â Â Â Â Â Â ]Â Â Â Â Â Â Â Â },Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â "Sid":Â "ListCloudwatchLogStreams",Â Â Â Â Â Â Â Â Â Â Â Â "Effect":Â "Allow",Â Â Â Â Â Â Â Â Â Â Â Â "Action":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "logs:DescribeLogStreams"Â Â Â Â Â Â Â Â Â Â Â Â ],Â Â Â Â Â Â Â Â Â Â Â Â "Resource":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "arn:aws-cn:logs:cn-north-1:012345678901:log-group:/aws/kinesis-analytics/kda-pyflink-demo:log-stream:*"Â Â Â Â Â Â Â Â Â Â Â Â ]Â Â Â Â Â Â Â Â },Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â "Sid":Â "PutCloudwatchLogs",Â Â Â Â Â Â Â Â Â Â Â Â "Effect":Â "Allow",Â Â Â Â Â Â Â Â Â Â Â Â "Action":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "logs:PutLogEvents"Â Â Â Â Â Â Â Â Â Â Â Â ],Â Â Â Â Â Â Â Â Â Â Â Â "Resource":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "arn:aws-cn:logs:cn-north-1:012345678901:log-group:/aws/kinesis-analytics/kda-pyflink-demo:log-stream:kinesis-analytics-log-stream"Â Â Â Â Â Â Â Â Â Â Â Â ]Â Â Â Â Â Â Â Â },Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â "Sid":Â "ReadInputStream",Â Â Â Â Â Â Â Â Â Â Â Â "Effect":Â "Allow",Â Â Â Â Â Â Â Â Â Â Â Â "Action":Â "kinesis:*",Â Â Â Â Â Â Â Â Â Â Â Â "Resource":Â "arn:aws-cn:kinesis:cn-north-1:012345678901:stream/kda-input-stream"Â Â Â Â Â Â Â Â },Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â "Sid":Â "WriteObjects",Â Â Â Â Â Â Â Â Â Â Â Â "Effect":Â "Allow",Â Â Â Â Â Â Â Â Â Â Â Â "Action":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:Abort*",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:DeleteObject*",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:GetObject*",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:GetBucket*",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:List*",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:ListBucket",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "s3:PutObject"Â Â Â Â Â Â Â Â Â Â Â Â ],Â Â Â Â Â Â Â Â Â Â Â Â "Resource":Â [Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "arn:aws-cn:s3:::kda-pyflink-shtian",Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "arn:aws-cn:s3:::kda-pyflink-shtian/*"Â Â Â Â Â Â Â Â Â Â Â Â ]Â Â Â Â Â Â Â Â }Â Â Â Â ]}

å›åˆ° Amazon Kinesis Data Analytics åº”ç”¨ç¨‹åºç•Œé¢ï¼Œç‚¹å‡» â€œè¿è¡Œâ€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLaCqJVn51sHuq3Lkx807aVpvOfLUQDSkYISB7AZcxuUgI0VjlGu4LkQ/640?wx_fmt=png)

ç‚¹å‡» â€œæ‰“å¼€ Apache Flink æ§åˆ¶é¢æ¿â€ï¼Œè·³è½¬åˆ° Flink çš„ç•Œé¢ã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLShhR0bicmtbIeB3JEYwIsicxqIWxDw65RicdvJascZkxM2ZYibiagjgCxUw/640?wx_fmt=jpeg)

ç‚¹å‡»æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚  

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLCBJBWzbLwTJdr9sQE20A55ib1yWXCQicB6dgV2JnoQUtrXZ1lqaAKZcw/640?wx_fmt=jpeg)

æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚è¿›ä¸€æ­¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ° Amazon S3 ä¸­éªŒè¯æ•°æ®æ˜¯å¦å·²ç»å†™å…¥ï¼Œè¿›å…¥åˆ°åˆ›å»ºçš„å­˜å‚¨æ¡¶ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»æˆåŠŸå†™å…¥ã€‚  

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcL8s3XWJ6rz44mHOsR7hZIkLjibmWodyXsh3xSo1QZ5jErgCYboWKFhbA/640?wx_fmt=png)

**ä½¿ç”¨ Amazon Glue å¯¹æ•°æ®è¿›è¡Œçˆ¬å–**

è¿›å…¥åˆ° Amazon Glue æœåŠ¡ç•Œé¢ï¼Œé€‰æ‹©çˆ¬ç½‘ç¨‹åºï¼Œç‚¹å‡» â€œæ·»åŠ çˆ¬ç½‘ç¨‹åº â€œï¼Œè¾“å…¥çˆ¬ç½‘ç¨‹åºåç§°ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLhBSh0gzL8FtJWibPaJ9YMgtheI8sy1VtXa3f5I55RTna0dO6YY8vpBQ/640?wx_fmt=png)

ä¿æŒæºç±»å‹ä¸å˜ï¼Œæ·»åŠ æ•°æ®å­˜å‚¨ä¸ºåˆ›å»ºçš„ Amazon S3 å­˜å‚¨æ¡¶è¾“å‡ºè·¯å¾„ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLZGoc0fMYbOTHmKM621MfsoVy3RbThsWgibJ8M79n1nEuEjq0Ouz5hKQ/640?wx_fmt=png)

é€‰æ‹©å·²æœ‰è§’è‰²æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„è§’è‰²ã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLJm98dMISiazojnEKz65ecibpERczU25pKLJMDepxXHvJbkQhKiblGZa7w/640?wx_fmt=jpeg)

é€‰æ‹©é»˜è®¤æ•°æ®åº“ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ·»åŠ è¡¨å‰ç¼€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLbxraAdEiaZ1TmvsmbwBubQjWZR3zgwg77LdfwDYiarP92lFffPhS314g/640?wx_fmt=png)

åˆ›å»ºå®Œæˆåï¼Œç‚¹å‡»æ‰§è¡Œã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLK6nnoCIDkgEEuWhGjlNeyz5SC9NzibQiasXCpT4rwPvFgIBBDYsibhO8w/640?wx_fmt=jpeg)

çˆ¬å–æˆåŠŸåï¼Œå¯ä»¥åœ¨æ•°æ®è¡¨ä¸­æŸ¥çœ‹åˆ°è¯¦ç»†ä¿¡æ¯ã€‚  

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLBkalVM1dB07esP4ZP29fSvd751f5EzZLRA3Hic1MxlhAEXXeVaRt6Pg/640?wx_fmt=png)

ç„¶åï¼Œå¯ä»¥åˆ‡æ¢åˆ° Amazon Athena æœåŠ¡æ¥æŸ¥è¯¢ç»“æœã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLEdse8Cud9tyTb3dIqA7iacQDibIvQla1PWTib6lUZWVecTBx6zhFdX1hQ/640?wx_fmt=png)

æ³¨ï¼šå¦‚æœå‡ºç° Amazon Glue çˆ¬ç½‘ç¨‹åºæˆ–è€… Amazon Athena æŸ¥è¯¢æƒé™é”™è¯¯ï¼Œå¯èƒ½æ˜¯ç”±äºå¼€å¯ Lake Formation å¯¼è‡´ï¼Œå¯ä»¥å‚è€ƒ**æ–‡æ¡£**æˆäºˆè§’è‰²ç›¸åº”çš„æƒé™ã€‚

-   æ–‡æ¡£

    [https://docs.aws.amazon.com/lake-formation/latest/dg/granting-catalog-permissions.html](https://docs.aws.amazon.com/lake-formation/latest/dg/granting-catalog-permissions.html)

**å°ç»“**

æœ¬æ–‡é¦–å…ˆä»‹ç»äº†åœ¨äºšé©¬é€Šäº‘ç§‘æŠ€å¹³å°ä¸Šä½¿ç”¨ Apache Flink çš„å¿«é€Ÿæ–¹å¼ â€“ Amazon Kinesis Data Analytics for Flinkï¼Œç„¶åé€šè¿‡ä¸€ä¸ªæ— æœåŠ¡å™¨æ¶æ„çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ Amazon Kinesis Data Analytics for Flink é€šè¿‡ PyFlink å®ç° Python æµæ•°æ®å¤„ç†å’Œåˆ†æï¼Œå¹¶é€šè¿‡ Amazon Glue å’Œ Amazon Athena å¯¹æ•°æ®è¿›è¡Œå³å¸­æŸ¥è¯¢ã€‚Amazon Kinesis Data Analytics for Flink å¯¹ Python çš„æ”¯æŒä¹Ÿå·²ç»åœ¨åœ¨å…‰ç¯æ–°ç½‘è¿è¥çš„äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½ï¼ˆåŒ—äº¬ï¼‰åŒºåŸŸåŠè¥¿äº‘æ•°æ®è¿è¥çš„äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½ï¼ˆå®å¤ï¼‰åŒºåŸŸä¸Šçº¿ï¼Œæ¬¢è¿ä½¿ç”¨ã€‚

**å‚è€ƒèµ„æ–™**

1.  [https://aws.amazon.com/solutions/implementations/aws-streaming-data-solution-for-amazon-kinesis/](https://aws.amazon.com/solutions/implementations/aws-streaming-data-solution-for-amazon-kinesis/)
2.  [https://docs.aws.amazon.com/lake-formation/latest/dg/granting-catalog-permissions.html](https://docs.aws.amazon.com/lake-formation/latest/dg/granting-catalog-permissions.html)
3.  [https://docs.aws.amazon.com/kinesisanalytics/latest/java/examples-python-s3.html](https://docs.aws.amazon.com/kinesisanalytics/latest/java/examples-python-s3.html)
4.  [https://ci.apache.org/projects/flink/flink-docs-release-1.11/](https://ci.apache.org/projects/flink/flink-docs-release-1.11/)

ç›¸å…³é˜…è¯»

\[

æ¨å‡º Amazon Kinesis Data Analytics Studio â€”â€”Â 

ä¸æµæ•°æ®å¿«é€Ÿäº¤äº’

ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹åŸæ–‡

]([https://mp.weixin.qq.com/s?\_\_biz=Mzg4NjU5NDUxNg==&mid=2247491154&idx=1&sn=4cd236d18398351b30b0ad399c0deaff&scene=21#wechat_redirect](https://mp.weixin.qq.com/s?__biz=Mzg4NjU5NDUxNg==&mid=2247491154&idx=1&sn=4cd236d18398351b30b0ad399c0deaff&scene=21#wechat_redirect) "[https://mp.weixin.qq.com/s?\_\_biz=Mzg4NjU5NDUxNg==&mid=2247491154&idx=1&sn=4cd236d18398351b30b0ad399c0deaff&scene=21#wechat_redirect"](https://mp.weixin.qq.com/s?__biz=Mzg4NjU5NDUxNg==&mid=2247491154&idx=1&sn=4cd236d18398351b30b0ad399c0deaff&scene=21#wechat_redirect"))

**æœ¬ç¯‡ä½œè€…**

![](https://mmbiz.qpic.cn/mmbiz_jpg/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLicEcQqGLTge4hVtzTEibE5kiaqF2j4ybT8ACPuvreIY4xdDpFHianyByeg/640?wx_fmt=jpeg)

**å²å¤©**

_äºšé©¬é€Šäº‘ç§‘æŠ€è§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆ_

æ‹¥æœ‰ä¸°å¯Œçš„äº‘è®¡ç®—ã€å¤§æ•°æ®å’Œæœºå™¨å­¦ä¹ ç»éªŒï¼Œç›®å‰è‡´åŠ›äºæ•°æ®ç§‘å­¦ã€æœºå™¨å­¦ä¹ ã€æ— æœåŠ¡å™¨ç­‰é¢†åŸŸçš„ç ”ç©¶å’Œå®è·µã€‚è¯‘æœ‰ã€Šæœºå™¨å­¦ä¹ å³æœåŠ¡ã€‹ã€ŠåŸºäº Kubernetes çš„ DevOps å®è·µã€‹ã€ŠPrometheus ç›‘æ§å®æˆ˜ã€‹ç­‰ã€‚

![](https://mmbiz.qpic.cn/mmbiz_gif/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLHqeXSvVp2IfALeFpxEB0qqgwJibRP8zqvuRd5j6tlm12G9LsuUmKvrA/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_gif/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLB2qAJkIDhK4StVicHC88BJbHbxolQrNlMAibk1iawibez2GqPt39y1qKCQ/640?wx_fmt=gif)

**å¬è¯´ï¼Œç‚¹å®Œä¸‹é¢ 4 ä¸ªæŒ‰é’®**

**å°±ä¸ä¼šç¢°åˆ° bug äº†ï¼**

![](https://mmbiz.qpic.cn/mmbiz_gif/kbAJm9Dy4QScibSpgNJb4q4xox8A3jTcLB2qAJkIDhK4StVicHC88BJbHbxolQrNlMAibk1iawibez2GqPt39y1qKCQ/640?wx_fmt=gif) 
 [https://mp.weixin.qq.com/s/fOxx37LCsP4NvcQwG1t0Rg](https://mp.weixin.qq.com/s/fOxx37LCsP4NvcQwG1t0Rg)
